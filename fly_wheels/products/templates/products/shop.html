{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
  .product-card{border:1px solid #eee;border-radius:12px;overflow:hidden; position:relative;}
  .product-image{max-height:220px;object-fit:contain}
  .badge-pack{ box-shadow:0 2px 6px rgba(0,0,0,.12); }
</style>

<div class="container my-5">

  <h2 class="text-center mb-4">Alloy Wheels</h2>
  <div class="row row-cols-1 row-cols-lg-2 g-4">
    {% for product in alloy_wheels %}
      <div class="col">
        <div class="card product-card h-100 shadow-sm">

          {# TOP-RIGHT BADGE #}
          {% if product.is_pack %}
            <span class="badge rounded-pill bg-secondary text-white position-absolute top-0 end-0 m-2 badge-pack">
              Pack of {{ product.pack_size }}
            </span>
          {% endif %}

          <div class="row g-0">
            <div class="col-md-5 p-3 d-flex align-items-center justify-content-center">
              {% if product.image %}
                <img src="{{ product.image.url }}" class="img-fluid product-image" alt="{{ product.name }}">
              {% else %}
                <img src="{% static 'img/placeholder-450x300.png' %}" class="img-fluid product-image" alt="{{ product.name }}">
              {% endif %}
            </div>

            <div class="col-md-7">
              <div class="card-body">
                <h5 class="card-title mb-1">{{ product.name }}</h5>
                <p class="text-muted mb-3">{{ product.brand }} â€¢ {{ product.size }}</p>

                <ul class="list-unstyled small mb-3">
                  <li><strong>Type:</strong> {{ product.get_category_display }}</li>
                  <li><strong>Weight:</strong> {{ product.weight }}</li>
                  {% if product.material %}<li><strong>Material:</strong> {{ product.material }}</li>{% endif %}
                  <li><strong>Quantity:</strong> {{ product.pack_label }}</li>
                  {% if product.delivery_estimate %}<li><strong>Delivery:</strong> {{ product.delivery_estimate }}</li>{% endif %}
                </ul>

                <div class="d-flex align-items-center justify-content-between">
                  <div class="d-flex align-items-center">
                    <span class="fw-semibold me-2">Â£{{ product.price|floatformat:2 }}</span>
                    {% if product.compare_at_price %}
                      <span class="text-muted text-decoration-line-through small me-2">
                        Â£{{ product.compare_at_price|floatformat:2 }}
                      </span>
                    {% endif %}
                    <small class="text-muted">{{ product.per_unit_label }}</small>
                    {# ðŸ”‡ removed the old inline badge here #}
                  </div>

                  <form method="POST" action="{% url 'add_to_cart' product.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="quantity" value="1">
                    <button type="submit" class="btn btn-outline-dark btn-sm">Add to Cart</button>
                  </form>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12"><div class="alert alert-light border">No alloy wheels yet.</div></div>
    {% endfor %}
  </div>

  <h2 class="text-center my-5">Track Edition</h2>
  <div class="row row-cols-1 row-cols-lg-2 g-4">
    {% for product in track_edition %}
      <div class="col">
        <div class="card product-card h-100 shadow-sm">

          {% if product.is_pack %}
            <span class="badge rounded-pill bg-secondary text-white position-absolute top-0 end-0 m-2 badge-pack">
              Pack of {{ product.pack_size }}
            </span>
          {% endif %}

          <div class="row g-0">
            <div class="col-md-5 p-3 d-flex align-items-center justify-content-center">
              {% if product.image %}
                <img src="{{ product.image.url }}" class="img-fluid product-image" alt="{{ product.name }}">
              {% else %}
                <img src="{% static 'img/placeholder-450x300.png' %}" class="img-fluid product-image" alt="{{ product.name }}">
              {% endif %}
            </div>

            <div class="col-md-7">
              <div class="card-body">
                <h5 class="card-title mb-1">{{ product.name }}</h5>
                <p class="text-muted mb-3">{{ product.brand }} â€¢ {{ product.size }}</p>

                <ul class="list-unstyled small mb-3">
                  <li><strong>Type:</strong> {{ product.get_category_display }}</li>
                  <li><strong>Weight:</strong> {{ product.weight }}</li>
                  {% if product.material %}<li><strong>Material:</strong> {{ product.material }}</li>{% endif %}
                  <li><strong>Quantity:</strong> {{ product.pack_label }}</li>
                  {% if product.delivery_estimate %}<li><strong>Delivery:</strong> {{ product.delivery_estimate }}</li>{% endif %}
                </ul>

                <div class="d-flex align-items-center justify-content-between">
                  <div class="d-flex align-items-center">
                    <span class="fw-semibold me-2">Â£{{ product.price|floatformat:2 }}</span>
                    {% if product.compare_at_price %}
                      <span class="text-muted text-decoration-line-through small me-2">
                        Â£{{ product.compare_at_price|floatformat:2 }}
                      </span>
                    {% endif %}
                    <small class="text-muted">{{ product.per_unit_label }}</small>
                  </div>

                  <form method="POST" action="{% url 'add_to_cart' product.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="quantity" value="1">
                    <button type="submit" class="btn btn-outline-dark btn-sm">Add to Cart</button>
                  </form>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12"><div class="alert alert-light border">No track wheels yet.</div></div>
    {% endfor %}
  </div>

</div>
{% endblock %}
